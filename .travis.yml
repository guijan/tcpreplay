language: c

os: linux

arch:
  - amd64
  - arm64
  - ppc64le

addons:
  apt:
    packages:
    - autogen
    - clang
    - libpcap-dev

jobs:
  include:
    - compiler: gcc
    - compiler: clang
      env: CI_BUILD_PREFIX=scan-build

script:
  - autoreconf -iv > build.log 2>&1 || (cat build.log && exit 1)
  - ${CI_BUILD_PREFIX} ./configure --enable-local-libopts > build.log 2>&1 || (cat build.log && exit 1)
  - ${CI_BUILD_PREFIX} make > build.log 2>&1 || (cat build.log && exit 1)
  - make dist > build.log 2>&1 || (cat build.log && exit 1)
  - make test || (cat test/test.log && exit 1)
